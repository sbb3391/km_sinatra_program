<!DOCTYPE html>
<html>
  <head>
  <style>
    .page {
      background-color: white;
      width: 50%;
      height: 1100px;
      border: solid 5px black;
      align-content: center;
      margin: auto;
      margin-bottom: 25px;
      position: relative;
    }

    .header {
      background-color: rgb(4, 4, 193);
      width: 90%;
      height: 7.5%;
      margin: auto;
      margin-top: 45px;
      margin-bottom: 15px;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
   
    }

    .header_text {
      color: white;
      font-size: 2.5em;
      font-weight: bold;
    }
    
    .photo {
      margin: auto;
      width: 80%;
      margin-top: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .accessories_header {
      background-color: rgb(4, 4, 193);
      width: 90%;
      height:4%;
      margin: auto;
      margin-top: 45px;
      margin-bottom: 15px;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      border: black 1px solid;
    }

    .accessories_header_text {
      color: white;
      font-weight: bold;
      font-size: 1.5em;
    }

    /* position: absolute;
    bottom: 40px;
    left: 46px;
    justify-content: center;
    align-items: center;
    margin: auto;
    overflow: hidden;
  } */

    .options {
      background-color: white;
      width: 90%;
      height: 26%;
      left: 44px;
      position: absolute;
      margin-bottom;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    .option:nth-child(4n+1) {
      background-color: rgb(194, 222, 250);
      border-top: 2px solid grey;
      border-bottom: 2px solid grey;
    }

    .option:nth-child(4n+2) {
      background-color: rgb(194, 222, 250);
      border-top: 2px solid grey;
      border-bottom: 2px solid grey;
    }

    .option:nth-last-child(-n+2) {
      border-bottom: 2px solid grey;
    }

    .option {
    width: 49%;
    height: 35px;
    max-height: 35px;
    margin-left: 6px;
    margin-bottom: 5px;
    display: inline-block;
    vertical-align: middle;
    }

    .option_text {
      position: relative;
      font-size: .9em;      f
    }

  /* .pricing_complete {
    width: 90%;
    height: 29%;
    margin: auto;
    position: relative;
  } */

  .pricing_complete {
    width: 90%;
    height: 335px;
    max-height: 335px;
    position: absolute;
    bottom: 40px;
    left: 46px;
    justify-content: center;
    align-items: center;
    margin: auto;
    overflow: hidden;
  }

 .pricing {
    width: 48%;
    height: 100%;
    max-height: 100%;
    display: inline-block;
    max-height: 325px;
    position: relative;
  }

  .one {
    margin-right: 23px;
    margin-left: 3px;
  }


  .pricing_header {
    width: 100%;
    background-color: rgb(4, 4, 193);
    height: 45px;
    max-height: 45px;
    position: absolute;
    top: 15px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-weight: bold;
    border: black 1px solid;
    font-size: 1.5em;
    
  }

  .pricing_content {
    width: 100%;
    background-color: white;
    top: 60px;
    max-height: 260px;
    margin-top: 18px;
    border: black 1px solid;
    position: relative;

  }

  .pricing_content table {
    margin: 5px;
    width: 100%;
    height: 75px;
    max-height: 75px;
    font-size: 1.3em;
  }

  </style>
  </head>
  <body>
    <h1>Here is your proposal to preview:</h1>
    
    <% @proposal.line_items.where(product_id: Product.all.where(category: "Engine")).each do |line_item| %>
      <% model = Product.find(line_item.product_id) %>
      
      <% product_price = 0 %>
      <% @proposal.line_items.where(product_id: Product.all.where(km_equipment: model.km_equipment)).each do |li| %>
        <% product_price += li.extended_price %>
      <% end %>

    <div class="page">
        <div class="header">
          <section class="header_text">
            <%= Product.find(line_item.product_id).name %>
          </section>
        </div>
        <div class="photo">
          <img src="https://www.mjflood.ie/media/2014/11/Konica-Minolta-AccurioPress-C3080_1-1-1024x330.jpg" width="600" height="180">
        </div>
        <div class="accessories_header">
            <section class="accessories_header_text">Equipment Options</section> 
        </div>
        <div class="options">
            <% @proposal.line_items.where(product_id: Product.all.where(km_equipment: Product.find(line_item.product_id).km_equipment)).each do |accessory| %>
              <div class="option">
                <p class="option_text"><%= Product.find(accessory.product_id).name.titleize %></p>
              </div>
            <% end %> 
        </div>
        <div class="pricing_complete">
          <div class="pricing one">
            <div class="pricing_header">
              <section class="options_text">
                Service Costs
              </section>
            </div>
            <div class="pricing_content">
              <table>
                <% if Product.all.find(line_item.product_id).km_equipment == "6120" %>
                  <tr>
                    <td>Mono Cost Per Impression:</td>
                    <td>$<%= line_item.mono_cpi %></td>
                  </tr>
                <% else %>
                  <tr>
                    <td>Mono Cost Per Impression:</td>
                    <td>$<%= line_item.mono_cpi %></td>
                  </tr>
                  <tr>
                    <td>Color Cost Per Impression:</td>
                    <td>$<%= line_item.color_cpi %></td>
                  </tr>
                <% end %>
              </table>
            </div>
          </div>
          <div class="pricing two">
            <div class="pricing_header">
              <section class="options_text">
                Equipment Costs
              </section>
            </div>
            <div class="pricing_content">
              <table>
                <% @proposal.proposal_pricing_options.each do |option| %>
                  <tr>
                    <td><%= PricingOption.find(option.pricing_option_id).name %></td>
                    <td>$<%= (PricingOption.find(option.pricing_option_id).lease_rate_factor) * @total_price %></td>
                  </tr>
                <% end %>
                </table>
            </div>
          </div>
        </div> 
      </div>
    <% end %>
 
  </body>
</html>